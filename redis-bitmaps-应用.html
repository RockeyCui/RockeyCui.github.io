<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <title>Redis系列-Redis-Bitmaps-应用（JAVA-lettuce客户端） | RockeyCui的博客</title>
  <meta name="keywords" content=" Redis ">
  <meta name="description" content="Redis系列-Redis-Bitmaps-应用（JAVA-lettuce客户端） | RockeyCui的博客">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="“我们先把产品做出来，后续再改进”，这根本做不到！">
<meta name="keywords" content="rockeycui cuishilei 崔石磊">
<meta property="og:type" content="website">
<meta property="og:title" content="关于我">
<meta property="og:url" content="https://cuishilei.com/about/index.html">
<meta property="og:site_name" content="RockeyCui的博客">
<meta property="og:description" content="“我们先把产品做出来，后续再改进”，这根本做不到！">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-08-01T12:00:22.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于我">
<meta name="twitter:description" content="“我们先把产品做出来，后续再改进”，这根本做不到！">


<link rel="icon" href="/img/favicon-32.ico">

<link href="/css/style.css?v=1.0.1" rel="stylesheet">

<link href="/css/hl_theme/darcula.css?v=1.0.1" rel="stylesheet">

<link href="//cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
<link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="/js/jquery.autocomplete.min.js?v=1.0.1"></script>

<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>



<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script src="/js/iconfont.js?v=1.0.1"></script>

  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2f5c46996ac0903b8efdb622749f822c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
</head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="false">
  <input class="theme_blog_path" value>
</div>

<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="/img/me.png" />
</a>
<div class="author">
    <span>崔石磊(RockeyCui)</span>
</div>

<div class="icon">
    
        
        <a title="github" href="https://github.com/RockeyCui" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
        <a title="email" href="mailto:rockeycui@163.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
</div>




<ul>
    <li><div class="all active">全部文章<small>(35)</small></div></li>
    
        
            
            <li><div data-rel="JAVA"><i class="fold iconfont icon-right"></i>JAVA<small>(24)</small></div>
                
                    <ul class="sub hide">
                        
                        <li><div data-rel="web后端">web后端<small>(11)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="cache">cache<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="flink">flink<small>(1)</small></div>
                            
                        </li>
                            
                        <li><div data-rel="算法">算法<small>(6)</small></div>
                            
                        </li>
                            
                    </ul>
                
            </li>
            
        
    
        
            
        
    
        
            
        
    
        
            
        
    
        
            
            <li><div data-rel="数据库">数据库<small>(1)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="Redis">Redis<small>(6)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="linux">linux<small>(2)</small></div>
                
            </li>
            
        
    
        
            
            <li><div data-rel="生活">生活<small>(1)</small></div>
                
            </li>
            
        
    
        
            
        
    
        
            
            <li><div data-rel="趣味">趣味<small>(1)</small></div>
                
            </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">关于</a><a style="width: 50%"  class="friends">友链</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="35">
<input type="hidden" id="yelog_site_word_count" value="28.4k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="back-title-list"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://blog.boolchow.com/">BoolChow</a></li>
            
            <li><a target="_blank" href="https://sunzhiqiang.com.cn/">勤奋的猪</a></li>
            
            <li><a target="_blank" href="https://blog.csdn.net/u013110743">LFW</a></li>
            
            <li><a target="_blank" href="https://my.oschina.net/u/2000675">张欢1993</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <form onkeydown="if(event.keyCode==13){return false;}">
        <input class="search" type="text" placeholder="Search..." autocomplete="off"id="local-search-input" >
        <i class="cross"></i>
        <span>
            <label for="tagswitch">Tags:</label>
            <input id="tagswitch" type="checkbox" style="display: none" />
            <i id="tagsWitchIcon"></i>
        </span>
    </form>
    <div class="tags-list">
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color5">JAVA</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color2">spring</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">cache</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">flink</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color4">数据库</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">Redis</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">DB</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color1">linux</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">生活</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">算法</a>
    </li>
    
    <li class="article-tag-list-item">
        <a href="javascript:" class="color3">趣味</a>
    </li>
    
    <div class="clearfix"></div>
</div>

    
    <nav id="title-list-nav">
        
        <a  class="数据库 "
           href="/oracle_demo1.html"
           data-tag="数据库"
           data-author="" >
            <span class="post-title" title="oracle 获得各种时间段">oracle 获得各种时间段</span>
            <span class="post-date" title="2020-08-05 18:36:08">2020/08/05</span>
        </a>
        
        <a  class="JAVA "
           href="/java8-stream-demo2.html"
           data-tag="JAVA"
           data-author="" >
            <span class="post-title" title="JAVA8-Stream-List 排序">JAVA8-Stream-List 排序</span>
            <span class="post-date" title="2020-06-16 18:21:02">2020/06/16</span>
        </a>
        
        <a  class="JAVA "
           href="/java8-stream-demo1.html"
           data-tag="JAVA"
           data-author="" >
            <span class="post-title" title="JAVA8-Stream-List 过滤">JAVA8-Stream-List 过滤</span>
            <span class="post-date" title="2020-06-15 18:21:02">2020/06/15</span>
        </a>
        
        <a  class="JAVA "
           href="/jpa-query-union.html"
           data-tag="JAVA,spring"
           data-author="" >
            <span class="post-title" title="Jpa @Query (JPQL) 复杂查询（联表，动态条件，分页）">Jpa @Query (JPQL) 复杂查询（联表，动态条件，分页）</span>
            <span class="post-date" title="2020-05-29 16:21:33">2020/05/29</span>
        </a>
        
        <a  class="Redis "
           href="/redis-set.html"
           data-tag="Redis"
           data-author="" >
            <span class="post-title" title="Redis系列-Redis-Set命令讲解（JAVA-lettuce客户端）">Redis系列-Redis-Set命令讲解（JAVA-lettuce客户端）</span>
            <span class="post-date" title="2019-11-05 19:24:47">2019/11/05</span>
        </a>
        
        <a  class="JAVA "
           href="/utc-str-to-timestamp.html"
           data-tag="JAVA"
           data-author="" >
            <span class="post-title" title="UTC-string to java.sql.Timestamp">UTC-string to java.sql.Timestamp</span>
            <span class="post-date" title="2019-10-12 20:21:33">2019/10/12</span>
        </a>
        
        <a  class="JAVA flink "
           href="/flink1.9-维表 join 自定义实现.html"
           data-tag="flink"
           data-author="" >
            <span class="post-title" title="flink1.9 维表 join 自定义实现 LookupableTableSource">flink1.9 维表 join 自定义实现 LookupableTableSource</span>
            <span class="post-date" title="2019-09-01 09:25:00">2019/09/01</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/ZK-分布式阻塞锁设计思路.html"
           data-tag="JAVA"
           data-author="" >
            <span class="post-title" title="ZK 分布式阻塞锁设计思路">ZK 分布式阻塞锁设计思路</span>
            <span class="post-date" title="2019-08-05 20:45:18">2019/08/05</span>
        </a>
        
        <a  class="JAVA cache "
           href="/Caffeine cache 实例代码demo.html"
           data-tag="JAVA,cache"
           data-author="" >
            <span class="post-title" title="Caffeine cache 实例代码demo">Caffeine cache 实例代码demo</span>
            <span class="post-date" title="2019-07-23 18:32:36">2019/07/23</span>
        </a>
        
        <a  class="Redis "
           href="/redis-lock.html"
           data-tag="Redis"
           data-author="" >
            <span class="post-title" title="Redis系列-Redis-分布式锁（JAVA-lettuce客户端）">Redis系列-Redis-分布式锁（JAVA-lettuce客户端）</span>
            <span class="post-date" title="2019-04-10 20:00:00">2019/04/10</span>
        </a>
        
        <a  class="Redis "
           href="/redis-bitmaps-应用.html"
           data-tag="Redis"
           data-author="" >
            <span class="post-title" title="Redis系列-Redis-Bitmaps-应用（JAVA-lettuce客户端）">Redis系列-Redis-Bitmaps-应用（JAVA-lettuce客户端）</span>
            <span class="post-date" title="2019-04-07 20:00:00">2019/04/07</span>
        </a>
        
        <a  class="Redis "
           href="/redis-hash.html"
           data-tag="Redis"
           data-author="" >
            <span class="post-title" title="Redis系列-Redis-Hash命令讲解（JAVA-lettuce客户端）">Redis系列-Redis-Hash命令讲解（JAVA-lettuce客户端）</span>
            <span class="post-date" title="2019-04-05 21:00:00">2019/04/05</span>
        </a>
        
        <a  class="Redis "
           href="/redis-list.html"
           data-tag="Redis"
           data-author="" >
            <span class="post-title" title="Redis系列-Redis-List命令讲解（JAVA-lettuce客户端）">Redis系列-Redis-List命令讲解（JAVA-lettuce客户端）</span>
            <span class="post-date" title="2019-04-03 21:00:00">2019/04/03</span>
        </a>
        
        <a  class="Redis "
           href="/redis-string.html"
           data-tag="Redis"
           data-author="" >
            <span class="post-title" title="Redis系列-Redis-String命令讲解（JAVA-lettuce客户端）">Redis系列-Redis-String命令讲解（JAVA-lettuce客户端）</span>
            <span class="post-date" title="2019-04-01 20:00:00">2019/04/01</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/logback mdc简单实现分布式系统追踪.html"
           data-tag="JAVA,spring"
           data-author="" >
            <span class="post-title" title="spring cloud 简单的分布式日志追踪实现">spring cloud 简单的分布式日志追踪实现</span>
            <span class="post-date" title="2019-02-01 21:10:02">2019/02/01</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/maven pom 优化遇到的坑.html"
           data-tag="JAVA"
           data-author="" >
            <span class="post-title" title="maven pom 优化导致 rocketmq 启动失败">maven pom 优化导致 rocketmq 启动失败</span>
            <span class="post-date" title="2018-11-11 17:10:00">2018/11/11</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/组织结构权限.html"
           data-tag="JAVA"
           data-author="" >
            <span class="post-title" title="组织结构及权限的设计">组织结构及权限的设计</span>
            <span class="post-date" title="2018-10-29 15:06:45">2018/10/29</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/单例模式-简单工厂在实际场景中的应用.html"
           data-tag="JAVA,spring"
           data-author="" >
            <span class="post-title" title="单例模式+简单工厂模式+模板方法模式在实际场景中的应用">单例模式+简单工厂模式+模板方法模式在实际场景中的应用</span>
            <span class="post-date" title="2018-10-11 18:46:54">2018/10/11</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/JAVA上传base64图片至腾讯云COS.html"
           data-tag="JAVA,spring"
           data-author="" >
            <span class="post-title" title="JAVA上传base64图片至腾讯云COS">JAVA上传base64图片至腾讯云COS</span>
            <span class="post-date" title="2018-10-03 19:24:36">2018/10/03</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/Spring ContextLoaderListener 启动流程解析二.html"
           data-tag="JAVA,spring"
           data-author="" >
            <span class="post-title" title="Spring ContextLoaderListener 启动流程解析二">Spring ContextLoaderListener 启动流程解析二</span>
            <span class="post-date" title="2018-09-30 19:00:00">2018/09/30</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/Spring ContextLoaderListener 启动流程解析一.html"
           data-tag="JAVA,spring"
           data-author="" >
            <span class="post-title" title="Spring ContextLoaderListener 启动流程解析一">Spring ContextLoaderListener 启动流程解析一</span>
            <span class="post-date" title="2018-09-22 21:00:00">2018/09/22</span>
        </a>
        
        <a  class="JAVA 算法 "
           href="/算法系列-排序算法-归并排序-JAVA.html"
           data-tag="JAVA,算法"
           data-author="" >
            <span class="post-title" title="算法系列-排序算法-归并排序（JAVA版）">算法系列-排序算法-归并排序（JAVA版）</span>
            <span class="post-date" title="2018-09-17 20:00:00">2018/09/17</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/java多叉树简单了解.html"
           data-tag="JAVA"
           data-author="" >
            <span class="post-title" title="java多叉树简单了解">java多叉树简单了解</span>
            <span class="post-date" title="2018-09-13 22:32:16">2018/09/13</span>
        </a>
        
        <a  class="JAVA 算法 "
           href="/算法系列-排序算法-希尔排序-JAVA.html"
           data-tag="JAVA,算法"
           data-author="" >
            <span class="post-title" title="算法系列-排序算法-希尔排序（JAVA版）">算法系列-排序算法-希尔排序（JAVA版）</span>
            <span class="post-date" title="2018-09-10 20:00:00">2018/09/10</span>
        </a>
        
        <a  class="JAVA 算法 "
           href="/算法系列-排序算法-插入排序-JAVA.html"
           data-tag="JAVA,算法"
           data-author="" >
            <span class="post-title" title="算法系列-排序算法-直接插入排序（JAVA版）">算法系列-排序算法-直接插入排序（JAVA版）</span>
            <span class="post-date" title="2018-09-02 20:00:00">2018/09/02</span>
        </a>
        
        <a  class="JAVA 算法 "
           href="/算法系列-排序算法-冒泡排序-JAVA.html"
           data-tag="JAVA,算法"
           data-author="" >
            <span class="post-title" title="算法系列-排序算法-冒泡排序（JAVA版）">算法系列-排序算法-冒泡排序（JAVA版）</span>
            <span class="post-date" title="2018-08-30 20:00:00">2018/08/30</span>
        </a>
        
        <a  class="JAVA 算法 "
           href="/算法系列-排序算法-选择排序-JAVA.html"
           data-tag="JAVA,算法"
           data-author="" >
            <span class="post-title" title="算法系列-排序算法-选择排序（JAVA版）">算法系列-排序算法-选择排序（JAVA版）</span>
            <span class="post-date" title="2018-08-24 20:00:00">2018/08/24</span>
        </a>
        
        <a  class="JAVA 算法 "
           href="/算法系列-二分查找-JAVA.html"
           data-tag="JAVA,算法"
           data-author="" >
            <span class="post-title" title="算法系列-二分查找（JAVA版）">算法系列-二分查找（JAVA版）</span>
            <span class="post-date" title="2018-08-18 18:00:00">2018/08/18</span>
        </a>
        
        <a  class="linux "
           href="/自己经常用到的命令.html"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="常用命令">常用命令</span>
            <span class="post-date" title="2018-08-16 21:29:00">2018/08/16</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/踩坑笔记.html"
           data-tag="JAVA,linux"
           data-author="" >
            <span class="post-title" title="踩坑笔记">踩坑笔记</span>
            <span class="post-date" title="2018-08-13 20:02:20">2018/08/13</span>
        </a>
        
        <a  class="linux "
           href="/nginx反向代理配置.html"
           data-tag="linux"
           data-author="" >
            <span class="post-title" title="记录nginx反向代理配置">记录nginx反向代理配置</span>
            <span class="post-date" title="2018-08-10 12:33:20">2018/08/10</span>
        </a>
        
        <a  class="JAVA "
           href="/Java-validate-注解验证.html"
           data-tag="JAVA"
           data-author="" >
            <span class="post-title" title="Java validate 注解验证工具类及自定义验证注解">Java validate 注解验证工具类及自定义验证注解</span>
            <span class="post-date" title="2018-08-07 21:32:16">2018/08/07</span>
        </a>
        
        <a  class="趣味 "
           href="/有意思的题目.html"
           data-tag="趣味"
           data-author="" >
            <span class="post-title" title="有意思的题目">有意思的题目</span>
            <span class="post-date" title="2018-07-18 19:59:16">2018/07/18</span>
        </a>
        
        <a  class="JAVA web后端 "
           href="/mybatis知识点.html"
           data-tag="JAVA,DB"
           data-author="" >
            <span class="post-title" title="mybatis知识点">mybatis知识点</span>
            <span class="post-date" title="2018-05-25 18:50:45">2018/05/25</span>
        </a>
        
        <a  class="生活 "
           href="/第一笔.html"
           data-tag="生活"
           data-author="" >
            <span class="post-title" title="第一笔">第一笔</span>
            <span class="post-date" title="2018-04-01 21:29:00">2018/04/01</span>
        </a>
        
    </nav>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div class="post">
    <div class="pjax">
        <article id="post-redis-bitmaps-应用" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Redis系列-Redis-Bitmaps-应用（JAVA-lettuce客户端）</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            
                <a href="javascript:" data-rel="Redis">Redis</a>
            
        </span>
        
        
        <span class="tag">
            
            <a href="javascript:" class="color1">Redis</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
        创建时间:<time class="date" title='更新时间: 2019-09-25 11:05:15'>2019-04-07 20:00</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:1.7k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读:<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-Bitmaps-简介"><span class="toc-text">Redis Bitmaps 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#操纵-Bitmaps"><span class="toc-text">操纵 Bitmaps</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#getbit-key-name-offset-命令"><span class="toc-text">getbit key-name offset 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setbit-key-name-offset-value-命令"><span class="toc-text">setbit key-name offset value 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bitcount-key-name-start-end-命令"><span class="toc-text">bitcount key-name [start end] 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bittop-op-dest-key-key-name-key-name-…-命令"><span class="toc-text">bittop op dest-key key-name [key-name …] 命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用实例"><span class="toc-text">应用实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#用户签到"><span class="toc-text">用户签到</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#源码链接"><span class="toc-text">源码链接</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-5 i,
    .toc-level-5 ol {
        display: none !important;
    }
</style>
</div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Redis-Bitmaps-简介"><a href="#Redis-Bitmaps-简介" class="headerlink" title="Redis Bitmaps 简介"></a>Redis Bitmaps 简介</h3><p>Bitmaps 并不是实际的数据类型，它对应的是字符串的二进制位串。可以把 Bitmaps 想象成一个以 位 为单位的数组，数组的每个单元只能存储 0 和 1，数组的下标在 Bitmaps 中叫做偏移量。</p>
<p>redis 限制字符串最大长度是512M，所以 Bitmaps 最大位数为 2^32。Bitmaps 的最大优势之一在存储信息时极其节约空间，假如我们的用户 id 是以唯一数字组合的，我们可以将用户的“开关”配置信息（如是否开启通知，是否接受来信，今日是否上线）保存在 Bitmaps，用户唯一数字标识代表索引，二进制 0 1 代表开关。我们存储 2^32 个用户信息，只需要 512M（谁会有这么多用户）！</p>
<h3 id="操纵-Bitmaps"><a href="#操纵-Bitmaps" class="headerlink" title="操纵 Bitmaps"></a>操纵 Bitmaps</h3><p>redis 对 Bitmaps 单独提供了一套命令（SETBIT GETBIT），所以在 Redis 中使用 Bitmaps 和使用字符串的方法不太相同。</p>
<p>本文中用的客户端为 lettuce <a href="https://github.com/lettuce-io/lettuce-core" target="_blank" rel="noopener">https://github.com/lettuce-io/lettuce-core</a></p>
<h4 id="getbit-key-name-offset-命令"><a href="#getbit-key-name-offset-命令" class="headerlink" title="getbit key-name offset 命令"></a>getbit key-name offset 命令</h4><p>将字符串当做是二进制位串（bit string），并返回位串中偏移量为 offset 的二进制位的值。</p>
<pre><code class="java">public class GetBitExample extends AbstractExample {

    public static void main(String[] args) {
        String str = &quot;hello world&quot;;
        //获取字符串的二进制串
        String bitStr = getStringBitStr(str);
        System.out.println(bitStr);
        stringCommands.set(&quot;getbit&quot;, str);
        for (int i = 0; i &lt; str.length() * 8; i++) {
            //一个英文字符占一个字节（Byte），一个字节等于8位（bit）
            if (i % 8 == 0 &amp;&amp; i != 0) {
                System.out.print(&quot; &quot;);
            }
            //获取偏移量位置的位值
            System.out.print(stringCommands.getbit(&quot;getbit&quot;, i));
        }
    }
}</code></pre>
<p>输出结果</p>
<pre><code class="java">1101000 1100101 1101100 1101100 1101111 100000 1110111 1101111 1110010 1101100 1100100
01101000 01100101 01101100 01101100 01101111 00100000 01110111 01101111 01110010 01101100 01100100</code></pre>
<p>可以看到，getbit 命令获取的正是字符对应的二进制字节中的某一偏移量的位值。</p>
<h4 id="setbit-key-name-offset-value-命令"><a href="#setbit-key-name-offset-value-命令" class="headerlink" title="setbit key-name offset value 命令"></a>setbit key-name offset value 命令</h4><p>将字符串当做是二进制位串（bit string），并将位串中偏移量为 offset 的二进制位的值设置为 value （0 或 1，不为0或1则报错）。</p>
<pre><code class="java">public class SetBitExample extends AbstractExample {

    public static void main(String[] args) {
        String str = &quot;hello world&quot;;
        stringCommands.set(&quot;setbit&quot;, str);
        for (int i = 0; i &lt; str.length() * 8; i++) {
            //一个英文字符占一个字节（Byte），一个字节等于8位（bit）
            if (i % 8 == 0 &amp;&amp; i != 0) {
                System.out.print(&quot; &quot;);
            }
            //获取偏移量位置的位值
            System.out.print(stringCommands.getbit(&quot;setbit&quot;, i));
        }
        System.out.println();
        //设置第五位值为1
        stringCommands.setbit(&quot;setbit&quot;, 5, 1);
        for (int i = 0; i &lt; str.length() * 8; i++) {
            //一个英文字符占一个字节（Byte），一个字节等于8位（bit）
            if (i % 8 == 0 &amp;&amp; i != 0) {
                System.out.print(&quot; &quot;);
            }
            //获取偏移量位置的位值
            System.out.print(stringCommands.getbit(&quot;setbit&quot;, i));
        }
    }
}</code></pre>
<p>输出结果</p>
<pre><code class="java">01101000 01100101 01101100 01101100 01101111 00100000 01110111 01101111 01110010 01101100 01100100
01101100 01100101 01101100 01101100 01101111 00100000 01110111 01101111 01110010 01101100 01100100</code></pre>
<h4 id="bitcount-key-name-start-end-命令"><a href="#bitcount-key-name-start-end-命令" class="headerlink" title="bitcount key-name [start end] 命令"></a>bitcount key-name [start end] 命令</h4><p>统计二进制位串内值为 1 的二进制位的数量，start 和 end 为可选值，给定了代表范围内统计 <strong>（注意 start 和 end 的单位是字节的范围）</strong>。</p>
<pre><code class="java">public class BitCountExample extends AbstractExample {

    public static void main(String[] args) {
        String str = &quot;hello world&quot;;
        stringCommands.set(&quot;bitcount&quot;, str);
        for (int i = 0; i &lt; str.length() * 8; i++) {
            //一个英文字符占一个字节（Byte），一个字节等于8位（bit）
            if (i % 8 == 0 &amp;&amp; i != 0) {
                System.out.print(&quot; &quot;);
            }
            //获取偏移量位置的位值
            System.out.print(stringCommands.getbit(&quot;bitcount&quot;, i));
        }
        System.out.println();
        //统计所有的字节
        Long bitcount = stringCommands.bitcount(&quot;bitcount&quot;);
        System.out.println(bitcount);
        //统计前两个字节
        bitcount = stringCommands.bitcount(&quot;bitcount&quot;, 0, 1);
        System.out.println(bitcount);
    }
}</code></pre>
<p>输出结果</p>
<pre><code class="java">01101000 01100101 01101100 01101100 01101111 00100000 01110111 01101111 01110010 01101100 01100100
45
7</code></pre>
<h4 id="bittop-op-dest-key-key-name-key-name-…-命令"><a href="#bittop-op-dest-key-key-name-key-name-…-命令" class="headerlink" title="bittop op dest-key key-name [key-name …] 命令"></a>bittop op dest-key key-name [key-name …] 命令</h4><p>对一个或多个二进制位串执行 op （包括 and or xor not）在内的任意一种按位运算操作，并将计算出的结果保存在 dest-key 键。</p>
<pre><code class="java">public class BitTopExample extends AbstractExample {

    public static void main(String[] args) {
        String str1 = &quot;hello&quot;;
        String str2 = &quot;world&quot;;
        stringCommands.set(&quot;bittop1&quot;, str1);
        stringCommands.set(&quot;bittop2&quot;, str2);
        printBitStr(&quot;bittop1&quot;, str1.length() * 8);
        printBitStr(&quot;bittop2&quot;, str2.length() * 8);

        stringCommands.bitopAnd(&quot;bittopand&quot;, &quot;bittop1&quot;, &quot;bittop2&quot;);
        System.out.println(&quot;and&quot;);
        printBitStr(&quot;bittopand&quot;, str2.length() * 8);

        stringCommands.bitopOr(&quot;bittopor&quot;, &quot;bittop1&quot;, &quot;bittop2&quot;);
        System.out.println(&quot;or&quot;);
        printBitStr(&quot;bittopor&quot;, str2.length() * 8);

        stringCommands.bitopXor(&quot;bittopxor&quot;, &quot;bittop1&quot;, &quot;bittop2&quot;);
        System.out.println(&quot;xor&quot;);
        printBitStr(&quot;bittopxor&quot;, str2.length() * 8);

        stringCommands.bitopNot(&quot;bittopnot&quot;, &quot;bittop1&quot;);
        System.out.println(&quot;not&quot;);
        printBitStr(&quot;bittopnot&quot;, str2.length() * 8);
    }

    private static void printBitStr(String key, int length) {
        for (int i = 0; i &lt; length; i++) {
            //一个英文字符占一个字节（Byte），一个字节等于8位（bit）
            if (i % 8 == 0 &amp;&amp; i != 0) {
                System.out.print(&quot; &quot;);
            }
            //获取偏移量位置的位值
            System.out.print(stringCommands.getbit(key, i));
        }
        System.out.println();
    }
}</code></pre>
<p>输出结果</p>
<pre><code class="java">01101000 01100101 01101100 01101100 01101111
01110111 01101111 01110010 01101100 01100100
and
01100000 01100101 01100000 01101100 01100100
or
01111111 01101111 01111110 01101100 01101111
xor
00011111 00001010 00011110 00000000 00001011
not
10010111 10011010 10010011 10010011 10010000</code></pre>
<h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><h4 id="用户签到"><a href="#用户签到" class="headerlink" title="用户签到"></a>用户签到</h4><p>每个用户都有自己的唯一数值对应，注意是数字类型的，因为在 bitmaps 中用户对应的是偏移量，位值 0或1 对应的是否签到。</p>
<p>以下为一段简单的代码模拟用户签到，查看用户是否签到，统计签到数量，用户量为 10W。</p>
<pre><code class="java">public class UserSign extends AbstractExample {
    private static List&lt;Integer&gt; users = new ArrayList&lt;&gt;();
    private static Random random = new Random();

    static {
        for (int i = 0; i &lt; 100000; i++) {
            users.add(i);
        }
    }

    public static void main(String[] args) {
        String today = DateTimeUtil.getNowDateStr(DateTimeUtil.DATE_FORMAT_YYMMDD);
        String todayKey = &quot;SIGN&quot; + today;
        System.out.println(&quot;今天是&quot; + today);
        //模拟用户签到，随机取出几个用户
        int total = random.nextInt(users.size() - 1);
        List&lt;Integer&gt; randomUsers = getUsers(total);
        for (Integer randomUser : randomUsers) {
            stringCommands.setbit(todayKey, randomUser, 1);
        }
        long begin, end;
        //判断用户是否签到
        begin = System.currentTimeMillis();
        int i = random.nextInt(UserSign.users.size() - 1);
        Integer test = UserSign.users.get(i);
        Long getbit = stringCommands.getbit(todayKey, test);
        System.out.println(&quot;用户 &quot; + test + &quot; 签到状态 &quot; + getbit);
        end = System.currentTimeMillis();
        System.out.println(&quot;time &quot; + (end - begin) + &quot; ms&quot;);
        //统计签到数
        begin = System.currentTimeMillis();
        Long bitcount = stringCommands.bitcount(todayKey);
        System.out.println(&quot;签到数 &quot; + bitcount + &quot; 预测数 &quot; + total);
        end = System.currentTimeMillis();
        System.out.println(&quot;time &quot; + (end - begin) + &quot; ms&quot;);
    }

    private static List&lt;Integer&gt; getUsers(int size) {
        Set&lt;Integer&gt; set = new HashSet&lt;&gt;();
        while (set.size() != size) {
            int nextInt = random.nextInt(users.size() - 1);
            set.add(users.get(nextInt));
        }
        return new ArrayList&lt;&gt;(set);
    }
}</code></pre>
<p>你们猜记录 10W 用户的签到状态用了多少内存？判断某个用户是否签到或者统计签到数用了多长时间？下面是结果：</p>
<pre><code class="java">今天是190919
签到数 18732
用户 15522 签到状态 0
time 7 ms
签到数 18732 预测数 18732
time 7 ms</code></pre>
<p>10W 用户统计签到数，只用了 7ms，够快了吧。那么，看看 10W 用户的签到数据占多少内存呢？算算就知道了，就是 100000/8/1024≈12KB，够少了吧。</p>
<h3 id="源码链接"><a href="#源码链接" class="headerlink" title="源码链接"></a>源码链接</h3><p><a href="https://github.com/RockeyCui/learn-normal/tree/master/learn-redis" target="_blank" rel="noopener">https://github.com/RockeyCui/learn-normal/tree/master/learn-redis</a></p>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 rockeycui@163.com </span>
    </div>
</article>


<p>
    <a href="javascript:void(0)" class="dashang" onclick="dashangToggle()">赏</a>
</p>


<div class="article_copyright">
    <p><span class="copy-title">文章标题:</span>Redis系列-Redis-Bitmaps-应用（JAVA-lettuce客户端）</p>
    <p><span class="copy-title">文章字数:</span><span class="post-count">1.7k</span></p>
    <p><span class="copy-title">本文作者:</span><a href="javascript:void(0)" title="崔石磊(RockeyCui)">崔石磊(RockeyCui)</a></p>
    <p><span class="copy-title">发布时间:</span>2019-04-07, 20:00:00</p>
    <span class="copy-title">原始链接:</span><a class="post-url" href="/redis-bitmaps-应用.html" title="Redis系列-Redis-Bitmaps-应用（JAVA-lettuce客户端）">https://cuishilei.com/redis-bitmaps-应用.html</a>
    <p>
        <span class="copy-title">版权声明:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
    </p>
</div>



    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'c5626bf15aa8eee3b949',
            clientSecret: '2cef675fceaff221e67b92c2645480fd537b5d44',
            repo: 'gittalk',
            owner: 'RockeyCui',
            admin: ['RockeyCui'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>







    </div>
    <div class="copyright">
        <p class="footer-entry">©2018-2020 RockeyCui 版权所有 ICP证：<a href='http://www.beian.miit.gov.cn'>冀ICP备18025584号</a></p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full"><span class="min "></span></button>
<button class="post-toc-menu"><span class="post-toc-menu-icons"></span></button>
<div class="post-toc"><span class="post-toc-title">目录</span>
    <div class="post-toc-content">

    </div>
</div>
<a class="" id="rocket" href="javascript:void(0)"></a>
    </div>
</div>
<div class="acParent"></div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="扫码支持">
            <img src="/img/weixin.jpg" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.0.1" ></script>

<script src="/js/script.js?v=1.0.1" ></script>
<script>
    var img_resize = 'default';
    /*作者、标签的自动补全*/
    $(function () {
        $('.search').AutoComplete({
            'data': ['#JAVA','#spring','#cache','#flink','#数据库','#Redis','#DB','#linux','#生活','#算法','#趣味',],
            'itemHeight': 20,
            'width': 418
        }).AutoComplete('show');
    })
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $(".post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().split('\n').length - 1, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0px;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
        .nav .hide-list.fullscreen {
            left: 492px
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    
    .post .pjax article .article-entry>ol, .post .pjax article .article-entry>ul, .post .pjax article>ol, .post .pjax article>ul{
        border: #e2dede solid 1px;
        border-radius: 10px;
        padding: 10px 32px 10px 56px;
    }
    .post .pjax article .article-entry li>ol, .post .pjax article .article-entry li>ul,.post .pjax article li>ol, .post .pjax article li>ul{
        padding-top: 5px;
        padding-bottom: 5px;
    }
    .post .pjax article .article-entry>ol>li, .post .pjax article .article-entry>ul>li,.post .pjax article>ol>li, .post .pjax article>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    .post .pjax article .article-entry li>ol>li, .post .pjax article .article-entry li>ul>li,.post .pjax article li>ol>li, .post .pjax article li>ul>li{
        margin-bottom: auto;
        margin-left: auto;
    }
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    
    .nav-right:before {
        content: ' ';
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        background: url("https://i.loli.net/2019/07/22/5d3521411f3f169375.png");
        background-repeat: no-repeat;
        background-position: 50% 0;
        -ms-background-size: cover;
        -o-background-size: cover;
        -moz-background-size: cover;
        -webkit-background-size: cover;
        background-size: cover;
    }
    

    
</style>







</html>
